<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Lincity-ng-commit] r1097 - in trunk: . data/gui src/lincity-ng
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/lincity-ng-commit/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:lincity-ng-commit%40lists.berlios.de?Subject=Re%3A%20%5BLincity-ng-commit%5D%20r1097%20-%20in%20trunk%3A%20.%20data/gui%20src/lincity-ng&In-Reply-To=%3C200608311244.k7VCipvw020171%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Lincity-ng-commit] r1097 - in trunk: . data/gui src/lincity-ng</H1>
    <B>wolfgangb at BerliOS</B> 
    <A HREF="mailto:lincity-ng-commit%40lists.berlios.de?Subject=Re%3A%20%5BLincity-ng-commit%5D%20r1097%20-%20in%20trunk%3A%20.%20data/gui%20src/lincity-ng&In-Reply-To=%3C200608311244.k7VCipvw020171%40sheep.berlios.de%3E"
       TITLE="[Lincity-ng-commit] r1097 - in trunk: . data/gui src/lincity-ng">wolfgangb at mail.berlios.de
       </A><BR>
    <I>Thu Aug 31 14:44:51 CEST 2006</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000028.html">[Lincity-ng-commit] r1098 - trunk/data/music
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: wolfgangb
Date: 2006-08-31 14:44:47 +0200 (Thu, 31 Aug 2006)
New Revision: 1097

Modified:
   trunk/RELNOTES
   trunk/data/gui/options.xml
   trunk/src/lincity-ng/MainMenu.cpp
   trunk/src/lincity-ng/MainMenu.hpp
   trunk/src/lincity-ng/Sound.cpp
Log:
Change background music in menu.



Modified: trunk/RELNOTES
===================================================================
--- trunk/RELNOTES	2006-07-28 10:59:39 UTC (rev 1096)
+++ trunk/RELNOTES	2006-08-31 12:44:47 UTC (rev 1097)
@@ -2,6 +2,7 @@
 
 * Display correct values for unemploment rate.
 * Port connects on all land parts.
+* Change background music in menu.
 
 *** LincityNG 1.0.3 *** [r1089 in svn]
 

Modified: trunk/data/gui/options.xml
===================================================================
--- trunk/data/gui/options.xml	2006-07-28 10:59:39 UTC (rev 1096)
+++ trunk/data/gui/options.xml	2006-08-31 12:44:47 UTC (rev 1097)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot;?&gt;
 &lt;gui&gt;
 	&lt;Image src=&quot;images/mainmenu/settings_back.png&quot; resizable=&quot;yes&quot;/&gt;
-	&lt;TableLayout rows=&quot;5&quot; cols=&quot;3&quot; border=&quot;false&quot;&gt;
+	&lt;TableLayout rows=&quot;6&quot; cols=&quot;3&quot; border=&quot;false&quot;&gt;
 		&lt;colsize col=&quot;1&quot; relative=&quot;1.3&quot;/&gt;
 		&lt;colsize col=&quot;2&quot; relative=&quot;1&quot;/&gt;
 		&lt;colsize col=&quot;3&quot; relative=&quot;0.5&quot;/&gt;
@@ -35,11 +35,32 @@
                 &lt;/cell&gt;
             &lt;/TableLayout&gt;
 		&lt;/cell&gt;
+        &lt;!-- Switch Track --&gt;
+        &lt;cell row=&quot;3&quot; col=&quot;2&quot; valign=&quot;center&quot; halign=&quot;center&quot;  colspan=&quot;2&quot;&gt;
+            &lt;TableLayout rows = &quot;1&quot; cols = &quot;3&quot;&gt;
+		    &lt;colsize col=&quot;1&quot; relative=&quot;1&quot;/&gt;
+		    &lt;colsize col=&quot;2&quot; relative=&quot;15&quot;/&gt;
+		    &lt;colsize col=&quot;3&quot; relative=&quot;1&quot;/&gt;
+                &lt;cell row=&quot;1&quot; col =&quot;1&quot; halign=&quot;right&quot; &gt;
+                    &lt;CheckButton name=&quot;TrackPrev&quot;&gt;
+                        &lt;text style=&quot;button&quot;&gt;&lt; &lt;/text&gt;
+                    &lt;/CheckButton&gt;
+                &lt;/cell&gt;
+                &lt;cell row=&quot;1&quot; col =&quot;2&quot; halign=&quot;center&quot; &gt;
+                    &lt;Paragraph translatable=&quot;no&quot;  name=&quot;musicParagraph&quot;&gt;02 - Robert van Herk - City Blues.ogg playing&lt;/Paragraph&gt;
+                &lt;/cell&gt;
+                &lt;cell row=&quot;1&quot; col =&quot;3&quot; halign=&quot;left&quot; &gt;
+                    &lt;CheckButton name=&quot;TrackNext&quot;&gt;
+                        &lt;text style=&quot;button&quot;&gt;&gt;  &lt;/text&gt;
+                    &lt;/CheckButton&gt;
+                &lt;/cell&gt;
+            &lt;/TableLayout&gt;
+        &lt;/cell&gt;
 		&lt;!-- Adjust FX Volume --&gt;
-		&lt;cell row=&quot;3&quot; col=&quot;2&quot; valign=&quot;center&quot; halign=&quot;left&quot;&gt;
+		&lt;cell row=&quot;4&quot; col=&quot;2&quot; valign=&quot;center&quot; halign=&quot;left&quot;&gt;
 			&lt;Paragraph style=&quot;listtitle&quot; translatable=&quot;yes&quot; &gt;Sound Effects&lt;/Paragraph&gt;
 		&lt;/cell&gt;
-		&lt;cell row=&quot;3&quot; col=&quot;3&quot;&gt;
+		&lt;cell row=&quot;4&quot; col=&quot;3&quot;&gt;
             &lt;TableLayout rows = &quot;1&quot; cols = &quot;3&quot;&gt;
                 &lt;cell row=&quot;1&quot; col =&quot;1&quot;&gt;
                     &lt;CheckButton name=&quot;FXVolumeMinus&quot;&gt;
@@ -60,16 +81,16 @@
             &lt;/TableLayout&gt;
 		&lt;/cell&gt;
 		
-		&lt;cell row=&quot;4&quot; col=&quot;2&quot; valign=&quot;center&quot; halign=&quot;left&quot;&gt;
+		&lt;cell row=&quot;5&quot; col=&quot;2&quot; valign=&quot;center&quot; halign=&quot;left&quot;&gt;
 			&lt;Paragraph style=&quot;listtitle&quot; translatable=&quot;yes&quot;&gt;Fullscreen&lt;/Paragraph&gt;
 		&lt;/cell&gt;
-		&lt;cell row=&quot;4&quot; col=&quot;3&quot;&gt;
+		&lt;cell row=&quot;5&quot; col=&quot;3&quot;&gt;
 			&lt;CheckButton name=&quot;Fullscreen&quot;&gt;
 				&lt;image src=&quot;images/mainmenu/settings/windowed.png&quot;/&gt;
 				&lt;image-checked src=&quot;images/mainmenu/settings/fullscreen.png&quot;/&gt;
 			&lt;/CheckButton&gt;
 		&lt;/cell&gt;
-		&lt;cell row=&quot;5&quot; col=&quot;2&quot; colspan=&quot;2&quot; halign=&quot;right&quot;&gt;
+		&lt;cell row=&quot;6&quot; col=&quot;2&quot; colspan=&quot;2&quot; halign=&quot;right&quot;&gt;
 			&lt;Button name=&quot;BackButton&quot;&gt;
 				&lt;text-caption style=&quot;button&quot; translatable=&quot;yes&quot;&gt;Ok&lt;/text-caption&gt;
 				&lt;image src=&quot;images/mainmenu/buttons/start.png&quot;/&gt;

Modified: trunk/src/lincity-ng/MainMenu.cpp
===================================================================
--- trunk/src/lincity-ng/MainMenu.cpp	2006-07-28 10:59:39 UTC (rev 1096)
+++ trunk/src/lincity-ng/MainMenu.cpp	2006-08-31 12:44:47 UTC (rev 1097)
@@ -238,6 +238,10 @@
         currentCheckButton-&gt;clicked.connect( makeCallback(*this, &amp;MainMenu::optionsMenuButtonClicked));
         currentCheckButton = getCheckButton(*optionsMenu, &quot;FXVolumeMinus&quot;);
         currentCheckButton-&gt;clicked.connect( makeCallback(*this, &amp;MainMenu::optionsMenuButtonClicked));
+        currentCheckButton = getCheckButton(*optionsMenu, &quot;TrackPrev&quot;);
+        currentCheckButton-&gt;clicked.connect( makeCallback(*this, &amp;MainMenu::optionsMenuButtonClicked));
+        currentCheckButton = getCheckButton(*optionsMenu, &quot;TrackNext&quot;);
+        currentCheckButton-&gt;clicked.connect( makeCallback(*this, &amp;MainMenu::optionsMenuButtonClicked));
         
         Button* currentButton = getButton(*optionsMenu, &quot;BackButton&quot;);
         currentButton-&gt;clicked.connect( makeCallback(*this, &amp;MainMenu::creditsBackButtonClicked));
@@ -258,6 +262,10 @@
     } else {
         getCheckButton(*optionsMenu, &quot;Fullscreen&quot;)-&gt;uncheck();
     }
+    //current background track
+    musicParagraph = getParagraph( *optionsMenu, &quot;musicParagraph&quot;);
+    musicParagraph-&gt;setText(getConfig()-&gt;playSongName);
+
     optionsMenu-&gt;resize(SDL_GetVideoSurface()-&gt;w, SDL_GetVideoSurface()-&gt;h);
 }
 
@@ -437,12 +445,63 @@
             initVideo(getConfig()-&gt;videoX, getConfig()-&gt;videoY);
             loadOptionsMenu();
         }
+    } else if( buttonName == &quot;TrackPrev&quot;){
+        changeTrack(false);
+    } else if( buttonName == &quot;TrackNext&quot;){
+        changeTrack(true);
     } else {
         std::cerr &lt;&lt; &quot;MainMenu::optionsMenuButtonClicked &quot; &lt;&lt; buttonName &lt;&lt; &quot; unknown Button!\n&quot;;
     }    
 }
 
 void
+MainMenu::changeTrack( bool next)
+{
+    std::string filename;
+    std::string directory = &quot;music/&quot;;
+    std::string fullname;
+    std::string currentname = getConfig()-&gt;playSongName;
+    std::string prevname = currentname;
+    std::string nextname = currentname;
+
+    bool hit = false;
+
+    char **files= PHYSFS_enumerateFiles(directory.c_str());
+    char **fptr=files;
+    while(*fptr)
+    {
+        fullname = directory;
+        fullname.append( *fptr );
+        filename.assign( *fptr );
+        
+        if(!PHYSFS_isDirectory(fullname.c_str())){
+            if( filename == currentname ){
+                hit = true;
+            } else if ( !hit ){
+                prevname = filename; 
+            } else {
+                nextname = filename;
+                break;
+            }
+        }
+        fptr++;
+    }
+    PHYSFS_freeList(files);
+
+    if(next){
+        if( nextname != currentname){
+            getSound()-&gt;playSound(&quot;Click&quot;);
+            getSound()-&gt;playMusic(nextname);
+        }
+    } else {
+        if( prevname != currentname){
+            getSound()-&gt;playSound(&quot;Click&quot;);
+            getSound()-&gt;playMusic(prevname);
+        }
+    }
+    musicParagraph-&gt;setText(getConfig()-&gt;playSongName);
+}
+void
 MainMenu::quitButtonClicked(Button* )
 {
     getSound()-&gt;playSound( &quot;Click&quot; );

Modified: trunk/src/lincity-ng/MainMenu.hpp
===================================================================
--- trunk/src/lincity-ng/MainMenu.hpp	2006-07-28 10:59:39 UTC (rev 1096)
+++ trunk/src/lincity-ng/MainMenu.hpp	2006-08-31 12:44:47 UTC (rev 1097)
@@ -19,6 +19,7 @@
 #define __MAINMENU_HPP__
 
 #include &quot;main.hpp&quot;
+#include &quot;gui/Paragraph.hpp&quot;
 
 class Component;
 class Desktop;
@@ -90,6 +91,9 @@
     static const Uint32 doubleClickTime = 1000;
     Uint32 lastClickTick;
     std::string doubleClickButtonName;
+    
+    Paragraph* musicParagraph;
+    void changeTrack( bool next);
 };
 
 #endif

Modified: trunk/src/lincity-ng/Sound.cpp
===================================================================
--- trunk/src/lincity-ng/Sound.cpp	2006-07-28 10:59:39 UTC (rev 1096)
+++ trunk/src/lincity-ng/Sound.cpp	2006-08-31 12:44:47 UTC (rev 1097)
@@ -174,6 +174,7 @@
 void
 Sound::playMusic(const std::string&amp; name)
 {
+    getConfig()-&gt;playSongName = name;
     if(!audioOpen)
         return;
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000028.html">[Lincity-ng-commit] r1098 - trunk/data/music
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/lincity-ng-commit">More information about the Lincity-ng-commit
mailing list</a><br>
</body></html>
